<!DOCTYPE html>
<!-- _layouts/distill.html --><html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Systems of Cities | Andrea  Musso</title>
    <meta name="author" content="Andrea  Musso">
    <meta name="description" content="The website a PhD student interested in cities.
">
    <meta name="keywords" content="cities, complexity, economics">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/building_icon.png">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://andreamusso96.github.io/projects/project_zipf/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    


    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/assets/js/distillpub/overrides.js"></script>
    
    <!-- Page/Post style -->
    <style type="text/css">
      .fixed-prop-container {
  position: relative;
  padding-bottom: 56%; /* for 16:9 ratio, adjust as needed */
  height: 0;
  overflow: hidden;
  }
  .fixed-prop-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

    </style>
  </head>

  <body>
<d-front-matter>
    <script async type="text/json">{
      "title": "Systems of Cities",
      "description": "",
      "published": "June 1, 2023",
      "authors": [
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Andrea </span>Musso</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1>Systems of Cities</h1>
        <p></p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        <d-contents>
          <nav class="l-text figcaption">
          <h3>Contents</h3>
            <div><a href="#introduction">Introduction</a></div>
            <div><a href="#data">Data</a></div>
            <div><a href="#methods">Methods</a></div>
            
          </nav>
        </d-contents>

        <hr>
<h1 id="introduction">Introduction</h1>

<p>Zipf’s and Gibrat’s law are two of the most famous laws in urban economics.
There is, however, some debate about if and when they hold. 
One of the main issues in this debate, in my view, is the ill definition of the context in which these laws hold: the system of cities.
<strong>What is a system of cities and how can we define it?</strong>
To date, systems of cities have typically been associated to countries. However, the country is a political entity, not an economic one.
Therefore, it is not clear why the country should be the natural unit of analysis for systems of cities.
This project looks at the early days of the US and attempts to establish how many systems of cities were present in the 1800s and when they started forming a single system.
The idea is to use the US as a case study to understand how systems of cities form and how they evolve.</p>

<h2 id="data">Data</h2>

<p>For the moment, I am using two sources of data. The first is a network database of transportation infrastructure in the US which comprises roads, railways and waterways from 1830 to 1920.
Donaldson and Hornbeck <d-cite key="donaldson2016railroads"></d-cite> provide this data to study the effect of the railways on the US economy. This data contains:</p>
<ul>
  <li>A complete map of railways, waterways and wagon transport routes between counties.</li>
  <li>An estimate of the transport cost between counties between 1830 and 1920.</li>
</ul>

<p>For the moment I only use the second part of the data, which is a matrix of transport costs between counties.
I do so out of simplicity rather than some theoretical reason.
The second data source is a <a href="https://github.com/cestastanford/historical-us-city-populations" rel="external nofollow noopener" target="_blank">database reporting the population of US cities</a> from 1800 to today.</p>

<h2 id="methods">Methods</h2>

<h3 id="network-of-cities">Network of cities</h3>

<p>As first step, I construct a city network, where cities represent nodes and edges are measured by a metric that approximates the “proximity” between two cities. 
The definition of this “proximity” is crucial and I consider three different definitions which capture different aspects of the problem:</p>

<ul>
  <li>
<strong>Inverse transport distance</strong>: Calculated as \(1/c^T\), where \(c^T\) represents the transport cost between two cities. This definition, however, disregards city sizes and is purely geographic.</li>
  <li>
<strong>Radiation proximity</strong>: Based on the flows predicted by the radiation model  <d-cite key="simini2012universal"></d-cite>. <strong>This approach tends to overestimate connections in sparse regions.</strong> The issue is that if there are no cities between two very distant cities, the model with tend to have a high proximity between those two distant cities. In modern times, geography is quite dense so this almost never occurs. But in the 1830s its a problem.</li>
  <li>
<strong>Gravity proximity</strong>: Utilizes the flows predicted by the gravity model. However, <strong>specifying the distance exponent remains an issue.</strong>
</li>
</ul>

<h3 id="clustering">Clustering</h3>

<p>After constructing the network of cities, my next step is to identify groups of cities within the network using community detection algorithms. I consider these groups to be “systems of cities”. To do this, I’ve tested a few different algorithms, each one works in a unique way:</p>

<ol>
  <li>
    <p><strong>Stochastic block model (SBM)</strong>: This algorithm tries to find groups of cities that are likely to form communities based on the structure of the network. It does this by trying to maximize the fit of a stochastic block model to the network graph. What’s interesting about this model is that it allows for different types of community structures, not just the typical type where each community is a closely knit group with few connections to the outside. It can also handle structures where there’s a central core with peripheral nodes around it. I use the graph tool library to implement the SBM. This library also provides a way to force the model to only find assortative communities (those where nodes are more connected within the community than outside it) using the gt.PPBlockState function. However, this function can’t handle weights.</p>
  </li>
  <li>
    <p><strong>Nested stochastic block model</strong>: This is like the regular SBM, but recursive. It works by first running the SBM on the network, then using the communities found to form a new graph where the nodes are the communities and the edges are weighted by the number of connections between the original communities. This process is then repeated. The graph tool library has an implementation for this as well, but it’s not perfect. For example, I can’t specify the mean of the distribution from which the edge weights are drawn (it bugs the code) and I can’t force it to only detect assortative communities. However, I think it wouldn’t be too difficult to create my own version of this algorithm that includes these features.</p>
  </li>
  <li>
    <p><strong>Louvain</strong>: This is a widely used algorithm for optimizing modularity, a measure of the strength of division of a network into communities. It uses a two-step process that’s repeated until it reaches a local optimum for modularity. Initially, each city is its own community. Then, the algorithm repeatedly scans through all the cities to see if they can increase the overall modularity by joining a neighboring community. If so, the city joins the community that provides the biggest boost to modularity. If not, the city stays in its current community. After this, a new graph is created where the communities are the nodes and the edges are weighted by the number of connections between communities. This process then starts again with the new graph.</p>
  </li>
  <li>
    <p><strong>Label propagation</strong>: This one works by giving each city a unique label and then repeatedly updating the labels based on the most common label among each city’s neighbors. Eventually, the labels stop changing and each community is made up of cities with the same label.</p>
  </li>
  <li>
    <p><strong>Fluid</strong>: This algorithm is similar to label propagation but has some differences. It requires specifying the number of labels in advance and each label has a total “density” of 1. This density is divided among the cities with that label. Larger communities will have lower densities for each city. The labels are then updated based on the label with the highest density among a city’s neighbors.</p>
  </li>
  <li>
    <p><strong>DBSCAN</strong>: This algorithm uses two parameters, epsilon and min(p), to define what a “core point” is. A core point is a city that has at least min(p) cities within epsilon distance. A city is a “periphery point” if it’s within epsilon distance of a core point, and an “outlier” if it’s neither a core nor a periphery point. Communities are made up of the core and periphery points.</p>
  </li>
  <li>
    <p><strong>HDBSCAN</strong>: This is an upgraded version of DBSCAN that doesn’t require specifying the epsilon parameter. Instead, it intelligently varies this parameter across different communities to detect groups with differing densities. For a more in-depth explanation, the sklearn library documentation is a good resource.</p>
  </li>
  <li>
    <p><strong>Geographic</strong>: Partition cities by latitude and longitude. For instance, cut the cities in two groups, each on one side of the Rocky Mountains.</p>
  </li>
</ol>

<p><strong>Question:</strong> Which procedure seems most plausible to detect communities in cities?</p>

<p>In order to feed networks to most of these methods (except DBSCAN and HDBSCAN), I need to filter out edges. I have, for the moment, adopted two approaches:</p>
<ul>
  <li>Maximum spanning tree: keep a maximum spanning tree as well as a percentage of the highest weighted edges.</li>
  <li>Nearest neighbor: keep the k nearest neighbors of each node.</li>
</ul>

<h1 id="results">Results</h1>

<h2 id="evolution-of-the-transport-network">Evolution of the transport network</h2>

<p>Here are plots of the transport network in different years using the maximum spanning tree method. The most notable feature is that most high weight edges are in the north west. 
The nodes are colored by the community they belong to as explained below.</p>

<h2 id="nested-stochastic-block-model">Nested stochastic block model</h2>

<p>Here are some results using the Nested stochastic block model algorithm for community detection on the 1890 cities network.
After running the algorithm, we observe the block matrices of communities. These matrices are symmetric and the entry \(i,j\) represents the number of edges between communities \(i\) and \(j\).</p>
<div class="l-page fixed-prop-container">
  <iframe src="/assets/zipf_project/block_matrix_nested_sbm_spanning.html" style="border: 1px dashed grey;"></iframe>
</div>

<p>Here we observe that at level 2 the algorithm detects 5 strongly assortative communities. 
On a map these communities can be observed below.</p>

<div class="l-page fixed-prop-container">
  <iframe src="/assets/zipf_project/1890_nested_sbm_map_spanning.pdf" style="border: 1px dashed grey;"></iframe>
</div>

<p>On this map, the vertex halo color denotes the level 1 communities, the vertex color denotes the level 2 community and the shape the level three communities.</p>

<p>Here, I repeat the same exercise by using the nearest neighbor instead of the spanning tree method.</p>

<div class="l-page fixed-prop-container">
  <iframe src="/assets/zipf_project/block_matrix_nested_sbm_neighbor.html" style="border: 1px dashed grey;"></iframe>
</div>

<div class="l-page fixed-prop-container">
  <iframe src="/assets/zipf_project/1890_nested_sbm_map_neighbor.pdf" style="border: 1px dashed grey;"></iframe>
</div>

<h3 id="population-statistics">Population statistics</h3>

<p>Next, we can plot population statistics within these communities. Here are, a plot of Gibrat’s and Zipf’s law for the level 2 communities at the community level using the spanning tree method.</p>

<div class="l-screen fixed-prop-container">
  <iframe src="/assets/zipf_project/zipf_1890_1890_nested_sbm.html" style="border: 1px dashed grey;"></iframe>
</div>

<div class="l-screen fixed-prop-container">
  <iframe src="/assets/zipf_project/growth_rates_1830_1890_nested_sbm.html" style="border: 1px dashed grey;"></iframe>
</div>

<h2 id="geographic-partition">Geographic partition</h2>

<p>I also tried to partition the cities in two groups, rockies and non-rockies.</p>

<div class="l-page fixed-prop-container">
  <iframe src="/assets/zipf_project/geo_map.pdf" style="border: 1px dashed grey;"></iframe>
</div>

<h3 id="population-statistics-1">Population statistics</h3>
<div class="l-screen fixed-prop-container">
  <iframe src="/assets/zipf_project/zipf_1890_1890_geo.html" style="border: 1px dashed grey;"></iframe>
</div>

<div class="l-screen fixed-prop-container">
  <iframe src="/assets/zipf_project/growth_rates_1830_1890_geo.html" style="border: 1px dashed grey;"></iframe>
</div>

<hr>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="/assets/bibliography/zipf_project.bib"></d-bibliography><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;">
  <script>
    let giscusTheme = localStorage.getItem("theme");
    let giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo": "alshedivat/al-folio",
        "data-repo-id": "MDEwOlJlcG9zaXRvcnk2MDAyNDM2NQ==",
        "data-category": "Comments",
        "data-category-id": "DIC_kwDOA5PmLc4CTBt6",
        "data-mapping": "title",
        "data-strict": "1",
        "data-reactions-enabled": "1",
        "data-emit-metadata": "0",
        "data-input-position": "bottom",
        "data-theme": giscusTheme,
        "data-lang": "en",
        "crossorigin": "anonymous",
        "async": "",
    };


    let giscusScript = document.createElement("script");
    Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
    document.getElementById("giscus_thread").appendChild(giscusScript);
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a>
</noscript>
</div>
</div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5">
      <div class="container">
        © Copyright 2024 Andrea  Musso. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  
</body>
</html>
